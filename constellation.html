<!DOCTYPE html>
<html>
<head>
<style>
body { margin: 0; overflow: hidden; background: #050508; }
canvas { display: block; }
#info { position: fixed; top: 10px; left: 10px; color: #668; font: 12px monospace; }
</style>
</head>
<body>
<div id="info">Emergent Constellation | 120 particles | attraction + repulsion</div>
<div style="position: fixed; top: 10px; right: 10px; color: #668; font: 12px monospace;">
</div>
<canvas id="c"></canvas>
<script>
const c = document.getElementById('c'), ctx = c.getContext('2d');
c.width = 1400; c.height = 900;

const N = 120, particles = [];

class Particle {
  constructor() {
    this.x = Math.random() * c.width;
    this.y = Math.random() * c.height;
    this.vx = (Math.random() - 0.5) * 0.8;
    this.vy = (Math.random() - 0.5) * 0.8;
    this.hue = Math.random() * 80 + 180; // blues, purples, teals
    this.phase = Math.random() * Math.PI * 2;
    this.pulseSpeed = 0.02 + Math.random() * 0.03;
  }
  
  update() {
    let fx = 0, fy = 0;
    
    // Forces from other particles
    for (let other of particles) {
      if (other === this) continue;
      let dx = other.x - this.x;
      let dy = other.y - this.y;
      let dist = Math.sqrt(dx*dx + dy*dy);
      
      // Attraction at medium distances (creates clusters)
      if (dist < 180 && dist > 8) {
        let force = (180 - dist) / 180;
        fx += (dx/dist) * force * 0.025;
        fy += (dy/dist) * force * 0.025;
      }
      // Repulsion at close distances (prevents collapse)
      if (dist < 25) {
        let force = (25 - dist) / 25;
        fx -= (dx/dist) * force * 0.15;
        fy -= (dy/dist) * force * 0.15;
      }
    }
    
    // Apply forces with damping
    this.vx = (this.vx + fx) * 0.97;
    this.vy = (this.vy + fy) * 0.97;
    this.x += this.vx;
    this.y += this.vy;
    
    // Soft boundaries - wrap around
    if (this.x < 0) this.x = c.width;
    if (this.x > c.width) this.x = 0;
    if (this.y < 0) this.y = c.height;
    if (this.y > c.height) this.y = 0;
    
    this.phase += this.pulseSpeed;
  }
  
  draw() {
    let brightness = 50 + Math.sin(this.phase) * 20;
    let alpha = 0.7 + Math.sin(this.phase) * 0.3;
    ctx.globalAlpha = alpha;
    ctx.fillStyle = `hsl(${this.hue}, 75%, ${brightness}%)`;
    ctx.beginPath();
    ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2);
    ctx.fill();
    
    // Glow
    ctx.globalAlpha = alpha * 0.3;
    ctx.beginPath();
    ctx.arc(this.x, this.y, 8, 0, Math.PI * 2);
    ctx.fill();
  }
}

// Create constellation
for (let i = 0; i < N; i++) particles.push(new Particle());

// Draw connections between nearby particles
function drawConnections() {
  for (let i = 0; i < particles.length; i++) {
    for (let j = i + 1; j < particles.length; j++) {
      let p1 = particles[i], p2 = particles[j];
      let dx = p2.x - p1.x, dy = p2.y - p1.y;
      let dist = Math.sqrt(dx*dx + dy*dy);
      
      if (dist < 120) {
        let alpha = (1 - dist/120) * 0.4;
        ctx.strokeStyle = `hsla(${(p1.hue + p2.hue)/2}, 50%, 60%, ${alpha})`;
        ctx.lineWidth = 0.8;
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.stroke();
      }
    }
  }
}

let frame = 0;
const snapshots = [];

function loop() {
  // Trails
  ctx.fillStyle = 'rgba(5, 5, 10, 0.12)';
  ctx.fillRect(0, 0, c.width, c.height);
  
  drawConnections();
  for (let p of particles) {
    p.update();
    p.draw();
  }
  
  frame++;
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
